#!/usr/bin/env python3
"""
cping 命令入口点
测试与 Codex 的连通性
"""

import sys
import os
from pathlib import Path

script_dir = Path(__file__).resolve().parent
lib_dir = script_dir.parent / "lib"
sys.path.insert(0, str(lib_dir))
from compat import setup_windows_encoding
setup_windows_encoding()

try:
    from codex_comm import CodexCommunicator

    def main():
        try:
            comm = CodexCommunicator()
            healthy, message = comm.ping(display=False)
            print(message)
            return 0 if healthy else 1

        except Exception as e:
            print(f"❌ 连通性测试失败: {e}")
            return 1

    if __name__ == "__main__":
        sys.exit(main())

except ImportError as e:
    print(f"❌ 导入模块失败: {e}")
    print("请确保 codex_comm.py 在同一目录下")
    sys.exit(1)
